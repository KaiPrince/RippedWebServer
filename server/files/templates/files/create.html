{% extends 'base.html' %}
{% block head %} 
<style>
  .bar {
    height: 18px;
    background: green;
  }
</style>
{% endblock %}
{% block header %}
<div class="row">
  <div class="col">
    <h1>{% block title %}Upload File{% endblock %}</h1>
  </div>
</div>
<div class="row">
  <div class="col">
    <a href="{{ url_for('files.index') }}">Back</a>
  </div>
</div>
{% endblock %} {% block content %}
<div class="row mt-4">
  <div class="col">
    <div id="create-container">
      <div id="progress">
        <div class="bar" style="width: 0%;"></div>
      </div>
    </div>
  </div>
</div>
<form method="post">
  <div class="form-group row">
    <label for="file_name" class="col-sm-2 col-form-label">File Name</label>
    <div class="col-sm-10">
      <input
      name="file_name"
      id="file_name"
      class="form-control"
      value="{{ request.form['file_name'] }}"
      required
      />
    </div>
  </div>
  <div class="form-group row">
    <label for="file" class="col-sm-2 col-form-label">File</label>
    <div class="col-sm-10">
      <input name="file" id="file" type=file required>
    </div>
  </div>
    <button type="submit" class="btn btn-primary">Submit</button>
</form>
{% endblock %}
{% block js %} 
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="{{ url_for('static', filename='js/vendor/jquery.ui.widget.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.iframe-transport.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.fileupload.js') }}"></script>
<script>
  $(function () {
    $('#file').fileupload({
      dataType: 'json',
      maxChunkSize: 10000000, // 10 MB
      // multipart: false,
      autoUpload: false,
      done: function (e, data) {
        $.each(data.result.files, function (index, file) {
          $('<p></p>').text(file.name).appendTo(document.body);
        });
        console.log("done", e, data)
      },
      send: function (e, data) {
        console.log("sending", e, data)
      },
      progressall: function (e, data) {
        var progress = parseInt(data.loaded / data.total * 100, 10);
        $('#progress .bar').css(
          'width',
          progress + '%'
        );
      },
      add: function (e, data) {
        data.context = $('<button></button>').text('Upload')
          .appendTo(document.body)
          .click(function () {
            data.context = $('<p></p>').text('Uploading...').replaceAll($(this));
            data.submit();
          });
      },
    });
  });
</script>
{% endblock %}

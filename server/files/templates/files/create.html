{% extends 'base.html' %}
{% block head %} 
{% endblock %}
{% block header %}
<div class="row">
  <div class="col">
    <h1>{% block title %}Upload File{% endblock %}</h1>
  </div>
</div>
<div class="row">
  <div class="col">
    <a href="{{ url_for('files.index') }}">Back</a>
  </div>
</div>
{% endblock %} {% block content %}
<div class="row mt-4">
  <div class="col">
    <div id="create-container">
      <progress id="progress" max="100" value="0" hidden>
      </progress>
      <form method="POST" enctype="multipart/form-data">
        <div class="form-group row">
          <label for="file_name" class="col-sm-2 col-form-label">File Name</label>
          <div class="col-sm-10">
            <input name="file_name" id="file_name" class="form-control" value="{{ request.form['file_name'] }}" required />
          </div>
        </div>
        <div class="form-group row">
          <label for="file" class="col-sm-2 col-form-label">File</label>
          <div class="col-sm-10">
            <input name="file" id="file" type=file required>
          </div>
        </div>
        <button id="submit-btn" type="submit" class="btn btn-primary" disabled>Submit</button>
      </form>
    </div>
  </div>
</div>
{% endblock %}
{% block js %} 
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="{{ url_for('static', filename='js/vendor/jquery.ui.widget.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.iframe-transport.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery.fileupload.js') }}"></script>
<script>
  $(function () {
    $('#create-container').fileupload({
      dataType: 'json',
      maxChunkSize: 10000000, // 10 MB
      // multipart: false,
      autoUpload: false,
      replaceFileInput: false,
      add: function (e, data) {
        $('#create-container').on('submit', function (e) {
          e.preventDefault()
          data.submit()
        })

        $('#submit-btn').removeAttr('disabled')
      },
      progressall: function (e, data) {
        var progress = parseInt(data.loaded / data.total * 100, 10);

        $('#progress').val(progress)
        $('#progress').text(`${progress}%`)
        $('#progress').removeAttr("hidden")
      },
      always: function (e, data) {
        const { jqXHR } = data
        const contentType = jqXHR.getResponseHeader("Content-Type")

        // If the server sends back an html page, abort the 
        //  transfer and load the page.
        if (contentType.includes("text/html")) {
          jqXHR.abort()

          var newDoc = document.open("text/html", "replace");
          newDoc.write(jqXHR.responseText);
          newDoc.close();
        }
      },
    });
  });
</script>
{% endblock %}
